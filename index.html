<!DOCTYPE html><!--

This page is automatically generated. See:
https://github.com/fortunejs/fortune/tree/master/website

--><meta charset="utf-8"><title>Fortune.js</title><meta name="description" content="Database abstraction layer for data-driven applications."><meta name="keywords" content="database,adapter,data,serializer,http,websocket,indexeddb,memory"><link rel="icon" href="./assets/piggu.png"><link rel="stylesheet" href="./assets/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/0.6.12/css/perfect-scrollbar.min.css"><header><div><a href="./"><img src="./assets/fortune_logo.svg" alt="Fortune.js" class="logo-type"></a><a href="https://github.com/fortunejs/fortune" class="corner">GitHub<span> Repository</span></a></div></header><main><article><h1 class="intro">Readme</h1><p class="intro">Fortune.js is a <a href="https://en.wikipedia.org/wiki/Database_abstraction_layer">database abstraction layer</a> for data-driven applications, with networking out of the box.</p><pre class="install"><code><a href="/fortune.min.js">npm install fortune --save</a></code></pre><h4 id="usage">Usage<a class="anchor" href="#usage" title="Link to this section “Usage”">#</a></h4><p>To get started, only record type definitions need to be provided. These definitions describe what data types may belong on a record and what relationships they may have, for which Fortune.js does inverse updates and maintains referential integrity. Here&#39;s an example of a basic micro-blogging service:</p><pre><code class="lang-js"><span class="hljs-keyword">const</span> fortune = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fortune'</span>) <span class="hljs-comment">// Works in web browsers, too.</span>

<span class="hljs-keyword">const</span> store = fortune({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span>,

    <span class="hljs-comment">// Following and followers are inversely related (many-to-many).</span>
    following: [ <span class="hljs-built_in">Array</span>(<span class="hljs-string">'user'</span>), <span class="hljs-string">'followers'</span> ],
    <span class="hljs-attr">followers</span>: [ <span class="hljs-built_in">Array</span>(<span class="hljs-string">'user'</span>), <span class="hljs-string">'following'</span> ],

    <span class="hljs-comment">// Many-to-one relationship of user posts to post author.</span>
    posts: [ <span class="hljs-built_in">Array</span>(<span class="hljs-string">'post'</span>), <span class="hljs-string">'author'</span> ]
  },
  <span class="hljs-attr">post</span>: {
    <span class="hljs-attr">message</span>: <span class="hljs-built_in">String</span>,

    <span class="hljs-comment">// One-to-many relationship of post author to user posts.</span>
    author: [ <span class="hljs-string">'user'</span>, <span class="hljs-string">'posts'</span> ]
  }
})
</code></pre><p>Note that the primary key <code>id</code> is reserved, so there is no need to specify this. Links are <code>id</code>s that are maintained internally at the application-level by Fortune.js, and are always denormalized so that every link has a back-link. What this also means is that changes in a record will affect the links in related records.</p><p>By default, the data is persisted in memory (and IndexedDB for the browser). There are adapters for databases such as <a href="https://github.com/fortunejs/fortune-mongodb">MongoDB</a>, <a href="https://github.com/fortunejs/fortune-postgres">Postgres</a>, and <a href="https://github.com/fortunejs/fortune-nedb">NeDB</a>. See the <a href="http://fortune.js.org/plugins/">plugins page</a> for more details.</p><p>Fortune has 4 main methods: <code>find</code>, <code>create</code>, <code>update</code>, &amp; <code>delete</code>. The method signatures are as follows:</p><pre><code class="lang-js"><span class="hljs-comment">// The first argument `type` is always required. The optional `include`</span>
<span class="hljs-comment">// argument is used for finding related records in the same request and is</span>
<span class="hljs-comment">// documented in the `request` method, and the optional `meta` is specific to</span>
<span class="hljs-comment">// the adapter.</span>
store.find(type, ids, options, include, meta)
store.create(type, records, include, meta) <span class="hljs-comment">// Records required.</span>
store.update(type, updates, include, meta) <span class="hljs-comment">// Updates required.</span>
store.delete(type, ids, include, meta)
</code></pre><p>The first method call to interact with the database will trigger a connection to the data store, and it returns the result as a Promise. The specific methods wrap around the more general <code>request</code> method, see the <a href="http://fortune.js.org/api/#fortune-request">API documentation for <code>request</code></a>.</p><h2 id="networking">Networking<a class="anchor" href="#networking" title="Link to this section “Networking”">#</a></h2><p><strong>Node.js only</strong>: Fortune.js implements HTTP server functionality for convenience, as a plain request listener which may be composed within larger applications:</p><pre><code class="lang-js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)

<span class="hljs-comment">// The `fortune.net.http` helper function returns a listener function which</span>
<span class="hljs-comment">// does content negotiation, and maps the internal response to a HTTP response.</span>
<span class="hljs-keyword">const</span> server = http.createServer(fortune.net.http(store))

store.connect().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> server.listen(<span class="hljs-number">1337</span>))
</code></pre><p>This yields an <em>ad hoc</em> JSON over HTTP API, as well as a HTML interface for humans. There are also serializers for <a href="https://github.com/fortunejs/fortune-micro-api">Micro API</a> (JSON-LD) and <a href="https://github.com/fortunejs/fortune-json-api">JSON API</a>.</p><p>Fortune.js implements its own <a href="http://fortune.js.org/api/#fortune.net-ws">wire protocol</a> based on <a href="https://developer.mozilla.org/docs/Web/API/WebSockets_API">WebSocket</a> and <a href="http://msgpack.org">MessagePack</a>, which is useful for soft real-time applications. A <a href="http://fortune.js.org/api/#fortune.net-ws">server</a> and <a href="http://fortune.js.org/api/#fortune.net-client">client</a> implementation is included.</p><h2 id="input-and-output-hooks">Input and Output Hooks<a class="anchor" href="#input-and-output-hooks" title="Link to this section “Input and Output Hooks”">#</a></h2><p>I/O hooks isolate business logic, and are part of what makes the interface reusable across different protocols. An input and output hook function may be defined per record type. Hook functions accept at least two arguments, the <code>context</code> object, the <code>record</code>, and optionally the <code>update</code> object for an <code>update</code> request. The method of an input hook may be any method except <code>find</code>, and an output hook may be applied on all methods.</p><p>An input hook function may optionally return or resolve a value to determine what gets persisted, and it is safe to mutate any of its arguments. The returned or resolved value must be the record if it&#39;s a create request, the update if it&#39;s an update request, or anything (or simply <code>null</code>) if it&#39;s a delete request. For example, an input hook function for a record may look like this:</p><pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">input</span> (<span class="hljs-params">context, record, update</span>) </span>{
  <span class="hljs-keyword">switch</span> (context.request.method) {
    <span class="hljs-comment">// If it's a create request, return the record.</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'create'</span>: <span class="hljs-keyword">return</span> record

    <span class="hljs-comment">// If it's an update request, return the update.</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'update'</span>: <span class="hljs-keyword">return</span> update

    <span class="hljs-comment">// If it's a delete request, the return value doesn't matter.</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'delete'</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  }
}
</code></pre><p>An output hook function may optionally return or resolve a record, and it is safe to mutate any of its arguments.</p><pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span> (<span class="hljs-params">context, record</span>) </span>{
  record.accessedAt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
  <span class="hljs-keyword">return</span> record
}
</code></pre><p>Based on whether or not the resolved record is different from what was passed in, serializers may decide not to show the resolved record of the output hook for update and delete requests.</p><p>Hooks for a record type may be defined as follows:</p><pre><code class="lang-js"><span class="hljs-keyword">const</span> store = fortune({
  <span class="hljs-attr">user</span>: { ... }
}, {
  <span class="hljs-attr">hooks</span>: {
    <span class="hljs-comment">// Hook functions must be defined in order: input first, output last.</span>
    user: [ input, output ]
  }
})
</code></pre><h2 id="use-cases">Use Cases<a class="anchor" href="#use-cases" title="Link to this section “Use Cases”">#</a></h2><ul><li>A server-side implementation of a web service over HTTP. The included HTTP implementation provides a basis for implementing application-level protocols, including media types such as HTML (included), <a href="http://micro-api.org">Micro API</a> and <a href="http://jsonapi.org">JSON API</a>, and covers standard input formats such as URL encoded and form data.</li><li>A persistence layer in web browsers. Under the hood, it uses IndexedDB, Web Worker, and MessagePack to achieve high performance for persisting structured data.</li><li>An abstraction layer for working with multiple databases. Write the same logic which will work across multiple adapters.</li><li>Soft real-time applications. Fortune.js includes its own <a href="http://fortune.js.org/api/#fortune.net-ws">wire protocol</a> based on WebSocket and MessagePack.</li></ul><h2 id="features-and-non-features">Features and Non-Features<a class="anchor" href="#features-and-non-features" title="Link to this section “Features and Non-Features”">#</a></h2><ul><li>Application-level relationships: inverse updates and referential integrity.</li><li>Transaction support for databases that support transactions, such as Postgres.</li><li>Dereferencing relationships in a single request via <code>include</code>.</li><li>Type validations, plus support for custom types.</li><li>IndexedDB adapter for web browsers, with memory fallback.</li><li>Soft real-time wire protocol for data synchronization between server and client.</li><li><strong>No</strong> ORM or active record pattern, just plain data objects.</li><li><strong>No</strong> coupling with network protocol, handle requests from anywhere.</li></ul><h2 id="requirements">Requirements<a class="anchor" href="#requirements" title="Link to this section “Requirements”">#</a></h2><p>Fortune.js is written in ECMAScript 5.1, with some ECMAScript 6 additions:</p><ul><li><strong>Promise</strong> (ES6): not supported in IE, supported in Edge. Bring your own implementation (optional).</li><li><strong>WeakMap</strong> (ES6): supported in IE11+, Edge. Polyfills exist, but they have their shortcomings since it must be implemented natively.</li></ul><footer>&copy; 2016 &nbsp;&mdash;&nbsp; <a href="https://raw.githubusercontent.com/fortunejs/fortune/master/LICENSE">MIT License</a></footer></article><nav><div><h4>Docs <span class="version">(v4.2.6)</span></h4><ul><li><a href="./"><span>Readme</span></a></li><li><a href="./api/"><span>API Reference</span></a></li><li><a href="./plugins/"><span>Plugins</span></a></li><li><a href="./concepts/"><span>Concepts</span></a></li><li><a href="./changelog/"><span>Changelog</span></a></li></ul><h4>Fortune</h4><ul><li><a href="./api/#fortune"><span>Fortune</span></a></li><li><a href="./api/#fortune-constructor"><span>constructor</span></a></li><li><a href="./api/#fortune-request"><span>request</span></a></li><li><a href="./api/#fortune-find"><span>find</span></a></li><li><a href="./api/#fortune-create"><span>create</span></a></li><li><a href="./api/#fortune-update"><span>update</span></a></li><li><a href="./api/#fortune-delete"><span>delete</span></a></li><li><a href="./api/#fortune-connect"><span>connect</span></a></li><li><a href="./api/#fortune-disconnect"><span>disconnect</span></a></li></ul><h4>Adapter</h4><ul><li><a href="./api/#adapter"><span>Adapter</span></a></li><li><a href="./api/#adapter-constructor"><span>constructor</span></a></li><li><a href="./api/#adapter-connect"><span>connect</span></a></li><li><a href="./api/#adapter-disconnect"><span>disconnect</span></a></li><li><a href="./api/#adapter-create"><span>create</span></a></li><li><a href="./api/#adapter-find"><span>find</span></a></li><li><a href="./api/#adapter-update"><span>update</span></a></li><li><a href="./api/#adapter-delete"><span>delete</span></a></li><li><a href="./api/#adapter-begintransaction"><span>beginTransaction</span></a></li><li><a href="./api/#adapter-endtransaction"><span>endTransaction</span></a></li><li><a href="./api/#adapter-applyoperators"><span>applyOperators</span></a></li></ul><h4>HTTP Server</h4><ul><li><a href="./api/#fortune.net-http"><span>http</span></a></li></ul><h4>HTTP Serializer</h4><ul><li><a href="./api/#httpserializer"><span>HttpSerializer</span></a></li><li><a href="./api/#httpserializer-constructor"><span>constructor</span></a></li><li><a href="./api/#httpserializer-processrequest"><span>processRequest</span></a></li><li><a href="./api/#httpserializer-processresponse"><span>processResponse</span></a></li><li><a href="./api/#httpserializer-parsepayload"><span>parsePayload</span></a></li><li><a href="./api/#httpserializer-mediatype"><span>mediaType</span></a></li></ul><h4>WebSocket</h4><ul><li><a href="./api/#fortune.net-ws"><span>ws</span></a></li><li><a href="./api/#fortune.net-client"><span>client</span></a></li><li><a href="./api/#fortune.net-request"><span>request</span></a></li><li><a href="./api/#fortune.net-sync"><span>sync</span></a></li></ul><hr></div></nav></main><!--
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/0.6.12/js/perfect-scrollbar.min.js"></script>
<script>Ps.initialize(document.querySelector('nav > div'))</script>
-->