/*!
 * Fortune.js
 * Version 5.0.2
 * MIT License
 * http://fortune.js.org
 */
!function e(r,t,n){function o(s,a){if(!t[s]){if(!r[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=t[s]={exports:{}};r[s][0].call(c.exports,function(e){var t=r[s][1][e];return o(t?t:e)},c,c.exports,e,r,t,n)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,r,t){(function(r){"use strict";function n(e,r,t){var n;return null===t?null===r:e?e.compare?0===e.compare(r,t):(n=p(b,function(r){return r[0]===e.prototype.constructor}),n?n[1](r,t):r===t):r===t}function o(e,r){return function(t){return e[w]?p(r,function(r){return n(e[v],t,r)}):n(e[v],t,r)}}function i(e,r,t){var n,i;for(n in r)if(i=r[n],Array.isArray(i)||(i=[i]),void 0===p(i,o(e[n],t[n])))return!1;return!0}function s(e,r,t){var n,o,i;for(n in r)if(o=t[n],i=e[n][w],r[n]){if(!o)return!1;if(i&&!o.length)return!1}else{if(o&&!i)return!1;if(i&&o.length)return!1}return!0}function a(e,r,t){var n,o,i,s,a,f,c={};for(n in r)if(o=e[n],i=o[v],s=o[w],i||s){if(a=r[n],f=t[n],null==f)return!1;if(s&&(f=f?f.length:0),c[n]||(c[n]=s?p(E,u(Number))[1]:i.compare||p(E,u(i))[1]),null!==a[0]&&c[n](f,a[0])<0)return!1;if(null!==a[1]&&c[n](a[1],f)<0)return!1}return!0}function u(e){return function(r){return r[0]===e.prototype.constructor}}function f(e,r){var t,n,o,i,s,a,f,c,l;return function(h,d){for(t in r){if(o=h[t],i=d[t],s=r[t],a=e[t],f=a[w],c=a[v],null===o)return 1;if(null===i)return-1;if(l=0,f)l=o.length-i.length;else if(c){if(n=c.compare||p(E,u(c))[1],!n)throw new Error('Missing "compare" function.');l=n(o,i)}if(0!==l)return s?l:-l}return 0}}var c=e("../../common/deep_equal"),l=e("../../common/message"),p=e("../../common/array/find"),h=e("../../common/generate_id"),d=e("../../common/errors"),y=d.BadRequestError,m=e("../../common/keys"),g=m.primary,v=m.type,w=m.isArray,b=[[Date,function(e,r){return e.getTime()===r.getTime()}],[r,function(e,r){return e.equals(r)}],[Object,function(e,r){return c(e,r)}]],E=[[Number,function(e,r){return e-r}],[String,function(e,r){return e===r?0:e>r?1:-1}],[Boolean,function(e,r){return e===r?0:e?1:-1}],[Date,function(e,r){return e.getTime()-r.getTime()}],[r,r.compare],[Object,function(){return 0}]];t.generateId=h,t.applyOptions=function(e,r,t,n){var o,u,c,h,d,m,v,w,b,E,A,P;if(t||(t={}),n||(n={}),m=n.language,w=t.range,b=t.match,E=t.exists,w||b||E)for(v=r,r=[],A=0,P=v.length;A<P;A++)u=v[A],w&&!a(e,w,u)||b&&!i(e,b,u)||E&&!s(e,E,u)||r.push(u);if(o=r.length,"fields"in t){if(h=!p(Object.keys(t.fields),function(e){return!t.fields[e]}),d=!p(Object.keys(t.fields),function(e){return t.fields[e]}),!h&&!d)throw new y(l("FieldsFormat",m));for(A=0,P=r.length;A<P;A++){u=r[A];for(c in u)c!==g&&(h&&!t.fields.hasOwnProperty(c)||d&&t.fields.hasOwnProperty(c))&&delete u[c]}}return"sort"in t&&(r=r.sort(f(e,t.sort))),("limit"in t||"offset"in t)&&(r=r.slice(t.offset,t.limit?(t.offset||0)+t.limit:r.length)),r.count=o,r}}).call(this,e("buffer").Buffer)},{"../../common/array/find":8,"../../common/deep_equal":19,"../../common/errors":20,"../../common/generate_id":22,"../../common/keys":24,"../../common/message":25,buffer:45}],2:[function(e,r,t){"use strict";var n=e("../common"),o=n.generateId;t.inputRecord=function(e,r){var t,n,i,s=this.recordTypes,a=this.keys.primary,u=this.keys.isArray,f=s[e],c=Object.getOwnPropertyNames(f),l={};l[a]=a in r?r[a]:o();for(t=0,n=c.length;t<n;t++)i=c[t],r.hasOwnProperty(i)?l[i]=r[i]:l[i]=f[i][u]?[]:null;return l},t.outputRecord=function(e,r){var t,n,o,i,s,a=this.recordTypes,u=this.keys.primary,f=this.keys.isArray,c=this.keys.denormalizedInverse,l=a[e],p=Object.getOwnPropertyNames(l),h={};for(h[u]=r[u],t=0,n=p.length;t<n;t++)o=p[t],i=r.hasOwnProperty(o),s=i?r[o]:l[o][f]?[]:null,l[o][c]?Object.defineProperty(h,o,{configurable:!0,writable:!0,value:s}):i&&(h[o]=s);return h}},{"../common":1}],3:[function(e,r,t){"use strict";var n=e("../../../common/apply_update"),o=e("../../../common/array/map"),i=e("../common"),s=i.applyOptions,a=e("./helpers"),u=a.inputRecord,f=a.outputRecord;r.exports=function(e){function r(r){e.call(this,r),this.options||(this.options={}),"recordsPerType"in this.options||(this.options.recordsPerType=1e3)}return r.prototype=Object.create(e.prototype),r.prototype.connect=function(){var e,r=this.recordTypes;this.db={};for(e in r)this.db[e]={};return Promise.resolve()},r.prototype.disconnect=function(){return delete this.db,Promise.resolve()},r.prototype.find=function(r,t,n,o){var i,a,u,c,l=this,p=l.recordTypes,h=p[r],d=l.db[r],y=[];if(t&&!t.length)return e.prototype.find.call(l);if(t)for(i=0,a=t.length;i<a;i++)u=t[i],d.hasOwnProperty(u)&&(c=d[u],delete d[u],d[u]=c,y.push(f.call(l,r,c)));else for(u in d)y.push(f.call(l,r,d[u]));return Promise.resolve(s(h,y,n,o))},r.prototype.create=function(e,r,t){var n,i,s,a,c,l,p=this,h=p.message,d=p.options.recordsPerType,y=p.keys.primary,m=p.errors.ConflictError,g=p.db[e];for(t||(t={}),l=t.language,r=o(r,function(r){return u.call(p,e,r)}),n=0,i=r.length;n<i;n++)if(s=r[n],a=s[y],g.hasOwnProperty(a))return Promise.reject(new m(h("RecordExists",l,{id:a})));for(n=0,i=r.length;n<i;n++)s=r[n],g[s[y]]=s;if(d&&(c=Object.keys(g),c.length>d))for(c=c.slice(0,c.length-d),n=0,i=c.length;n<i;n++)delete g[c[n]];return Promise.resolve(o(r,function(r){return f.call(p,e,r)}))},r.prototype.update=function(r,t){var o,i,s,a,c,l=this,p=l.keys.primary,h=l.db[r],d=0;if(!t.length)return e.prototype.update.call(l);for(o=0,i=t.length;o<i;o++)s=t[o],a=s[p],c=h[a],c&&(d++,c=f.call(l,r,c),n(c,s),delete h[a],h[a]=u.call(l,r,c));return Promise.resolve(d)},r.prototype.delete=function(r,t){var n,o,i,s=this.db[r],a=0;if(t&&!t.length)return e.prototype.delete.call(this);if(t)for(n=0,o=t.length;n<o;n++)i=t[n],s[i]&&(delete s[i],a++);else for(i in s)delete s[i],a++;return Promise.resolve(a)},r.common=i,r}},{"../../../common/apply_update":6,"../../../common/array/map":10,"../common":1,"./helpers":2}],4:[function(e,r,t){"use strict";function n(e){o(this,e)}var o=e("../common/assign"),i=e("./adapters/memory");n.prototype.constructor=function(){},delete n.prototype.constructor,n.prototype.connect=function(){return Promise.resolve()},n.prototype.disconnect=function(){return Promise.resolve()},n.prototype.create=function(){return Promise.resolve([])},n.prototype.find=function(){var e=[];return e.count=0,Promise.resolve(e)},n.prototype.update=function(){return Promise.resolve(0)},n.prototype.delete=function(){return Promise.resolve(0)},n.prototype.beginTransaction=function(){return Promise.resolve(this)},n.prototype.endTransaction=function(){return Promise.resolve()},n.prototype.applyOperators=function(e){return e},n.DefaultAdapter=i(n),r.exports=n},{"../common/assign":14,"./adapters/memory":3}],5:[function(e,r,t){"use strict";function n(e){var r,t;if(t=Array.isArray(e.adapter)?e.adapter:[e.adapter],"function"!=typeof t[0])throw new TypeError("The adapter must be a function.");if(r=o.prototype.isPrototypeOf(t[0].prototype)?t[0]:t[0](o),!o.prototype.isPrototypeOf(r.prototype))throw new TypeError("The adapter must inherit the Adapter class.");return new r({options:t[1]||{},recordTypes:e.recordTypes,common:i,errors:s,keys:a,message:u,Promise:Promise})}var o=e("./"),i=e("../common"),s=e("../common/errors"),a=e("../common/keys"),u=e("../common/message");r.exports=n},{"../common":23,"../common/errors":20,"../common/keys":24,"../common/message":25,"./":4}],6:[function(e,r,t){"use strict";var n=e("./array/pull");r.exports=function(e,r){var t;for(t in r.replace)e[t]=r.replace[t];for(t in r.push)e[t]=e[t]?e[t].concat(r.push[t]):[].concat(r.push[t]);for(t in r.pull)e[t]=e[t]?n(e[t],r.pull[t]):[]}},{"./array/pull":11}],7:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o=[],i=0;for(t=0,n=e.length;t<n;t++)r(e[t],t,e)&&(o[i++]=e[t]);return o}},{}],8:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o,i;for(t=0,n=e.length;t<n;t++)if(o=e[t],i=r(o))return o}},{}],9:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n;for(t=0,n=e.length;t<n;t++)if(e[t]===r)return!0;return!1}},{}],10:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o=[],i=0;for(t=0,n=e.length;t<n;t++)o[i++]=r(e[t],t,e);return o}},{}],11:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o,i={},s=[];if(Array.isArray(r))for(n=0,o=r.length;n<o;n++)i[r[n]]=!0;else i[r]=!0;for(n=e.length;n--;)t=e[n],i.hasOwnProperty(t)||s.push(t);return s}},{}],12:[function(e,r,t){"use strict";r.exports=function(e,r,t){var n,o,i=t;for(n=0,o=e.length;n<o;n++)i=r(i,e[n],n,e);return i}},{}],13:[function(e,r,t){"use strict";r.exports=function(e){var r,t,n,o={},i=[];for(r=0,t=e.length;r<t;r++)n=e[r],o.hasOwnProperty(n)||(i.push(n),o[n]=!0);return i}},{}],14:[function(e,r,t){"use strict";r.exports=function(e){var r,t,n,o;for(r=1,t=arguments.length;r<t;r++)if(o=arguments[r],null!=o)for(n in o)e[n]=o[n];return e}},{}],15:[function(e,r,t){"use strict";r.exports=function(e){var r=Number.parseFloat(e);return e-r+1>=0?r:e}},{}],16:[function(e,r,t){(function(t){"use strict";var n=e("./errors"),o=e("./message"),i=e("./cast_to_number"),s=n.BadRequestError,a=t.from||function(e,r){return new t(e,r)},u=[[Number,function(e){return parseFloat(e)}],[Date,function(e,r){if("string"==typeof e&&(e=Date.parse(e),Number.isNaN(e)))throw new s(o("DateISO8601",r.language));if(e=new Date(e),Number.isNaN(e.getTime()))throw new s(o("DateInvalid",r.language));return e}],[t,function(e,r){var t=r&&r.bufferEncoding?r.bufferEncoding:"base64";if("string"!=typeof e)throw new s(o("BufferEncoding",r.language,{bufferEncoding:t}));return a(e,t)}],[Boolean,function(e){return"string"==typeof e?"true"===e:Boolean(e)}],[Object,function(e,r){if("string"==typeof e)return JSON.parse(e);if("object"==typeof e)return e;throw new s(o("JSONParse",r.language))}],[String,function(e){return""+e}]];r.exports=function(e,r,t){var n,o,s,a;if(""===e)return null;if(!r)return i(e);for(n=0,o=u.length;n<o;n++)if(s=u[n],s[0]===r){a=s[1];break}return a&&null!==e?a(e,t):e}}).call(this,e("buffer").Buffer)},{"./cast_to_number":15,"./errors":20,"./message":25,buffer:45}],17:[function(e,r,t){"use strict";r.exports=function e(r){var t,n,o,i;if(Array.isArray(r))i=!0;else if(null==r||Object.getPrototypeOf(r)!==Object.prototype)return r;t=i?[]:{};for(n in r)o=r[n],t[n]=null!=o&&Object.getPrototypeOf(o)===Object.prototype||Array.isArray(o)?e(o):o;return t}},{}],18:[function(e,r,t){"use strict";t.primary="id",t.type="type",t.link="link",t.inverse="inverse",t.isArray="isArray",t.denormalizedInverse="__denormalizedInverse__",t.change="change",t.sync="sync",t.connect="connect",t.disconnect="disconnect",t.failure="failure",t.find="find",t.create="create",t.update="update",t.delete="delete"},{}],19:[function(e,r,t){(function(e){"use strict";function t(r,n){var o,i,s,a=0,u=0;if(r===n)return!0;if(!r||!n)return!1;if(r.prototype!==n.prototype)return!1;for(o in r)if(a++,i=r[o],s=n[o],"object"!=typeof i){if(e.isBuffer(i)){if(!e.isBuffer(s)||!i.equals(s))return!1}else if(i&&"function"==typeof i.getTime){if(!s||"function"!=typeof s.getTime||i.getTime()!==s.getTime())return!1}else if(i!==s)return!1}else if("object"!=typeof s||!t(i,s))return!1;for(o in n)u++;return a===u}r.exports=t}).call(this,{isBuffer:e("../../node_modules/is-buffer/index.js")})},{"../../node_modules/is-buffer/index.js":50}],20:[function(e,r,t){"use strict";var n=e("./response_classes");t.BadRequestError=n.BadRequestError,t.UnauthorizedError=n.UnauthorizedError,t.ForbiddenError=n.ForbiddenError,t.NotFoundError=n.NotFoundError,t.MethodError=n.MethodError,t.NotAcceptableError=n.NotAcceptableError,t.ConflictError=n.ConflictError,t.UnsupportedError=n.UnsupportedError,t.nativeErrors=n.nativeErrors},{"./response_classes":27}],21:[function(e,r,t){"use strict";var n=e("./constants");t.change=n.change,t.sync=n.sync,t.connect=n.connect,t.disconnect=n.disconnect,t.failure=n.failure},{"./constants":18}],22:[function(e,r,t){"use strict";r.exports=function(){return Date.now()+"-"+("00000000"+Math.floor(Math.random()*Math.pow(2,32)).toString(16)).slice(-8)}},{}],23:[function(e,r,t){"use strict";r.exports={constants:e("./constants"),keys:e("./keys"),events:e("./events"),methods:e("./methods"),assign:e("./assign"),castToNumber:e("./cast_to_number"),castValue:e("./cast_value"),clone:e("./clone"),deepEqual:e("./deep_equal"),generateId:e("./generate_id"),message:e("./message"),responses:e("./response_classes"),errors:e("./errors"),successes:e("./success"),filter:e("./array/filter"),find:e("./array/find"),includes:e("./array/includes"),map:e("./array/map"),pull:e("./array/pull"),reduce:e("./array/reduce"),unique:e("./array/unique")}},{"./array/filter":7,"./array/find":8,"./array/includes":9,"./array/map":10,"./array/pull":11,"./array/reduce":12,"./array/unique":13,"./assign":14,"./cast_to_number":15,"./cast_value":16,"./clone":17,"./constants":18,"./deep_equal":19,"./errors":20,"./events":21,"./generate_id":22,"./keys":24,"./message":25,"./methods":26,"./response_classes":27,"./success":28}],24:[function(e,r,t){"use strict";var n=e("./constants");t.primary=n.primary,t.type=n.type,t.link=n.link,t.isArray=n.isArray,t.inverse=n.inverse,t.denormalizedInverse=n.denormalizedInverse},{"./constants":18}],25:[function(e,r,t){"use strict";function n(e,r,t){var i,s;if(r&&n.hasOwnProperty(r)||(r=n.defaultLanguage),!n[r].hasOwnProperty(e))return n[r][o]||n.en[o];i=n[r][e];for(s in t)i=i.replace("{"+s+"}",t[s]);return i}var o="GenericError";r.exports=n,Object.defineProperty(n,"defaultLanguage",{value:"en",writable:!0}),n.en={GenericError:"An internal error occurred.",MalformedRequest:"The request was malformed.",InvalidBody:"The request body is invalid.",SerializerNotFound:'The serializer for "{id}" does not exist.',InputOnly:"Input only.",InvalidID:"An ID is invalid.",DateISO8601:"Date string must be an ISO 8601 formatted string.",DateInvalid:"Date value is invalid.",BufferEncoding:"Buffer value must be a {bufferEncoding}-encoded string.",JSONParse:"Could not parse value as JSON.",MissingPayload:"Payload is missing.",SpecifiedIDs:"IDs should not be specified.",InvalidURL:"Invalid URL.",RelatedRecordNotFound:'A related record for the field "{field}" was not found.',CreateRecordsInvalid:"There are no valid records to be created.",CreateRecordsFail:"Records could not be created.",CreateRecordMissingID:"An ID on a created record is missing.",DeleteRecordsMissingID:"IDs are required for deleting records.",DeleteRecordsInvalid:"A record to be deleted could not be found.",DeleteRecordsFail:"Not all records specified could be deleted.",UnspecifiedType:"The type is unspecified.",InvalidType:'The requested type "{type}" is not a valid type.',InvalidMethod:'The method "{method}" is unrecognized.',CollisionToOne:'Multiple records can not have the same to-one link value on the field "{field}".',CollisionDuplicate:'Duplicate ID "{id}" in the field "{field}".',UpdateRecordMissing:"A record to be updated could not be found.",UpdateRecordsInvalid:"There are no valid updates.",UpdateRecordMissingID:"An ID on an update is missing.",EnforceArrayType:'The value of "{key}" is invalid, it must be an array with values of type "{type}".',EnforceArray:'The value of "{key}" is invalid, it must be an array.',EnforceSameID:'An ID of "{key}" is invalid, it cannot be the same ID of the record.',EnforceSingular:'The value of "{key}" can not be an array, it must be a singular value.',EnforceValue:'The value of "{key}" is invalid, it must be a "{type}".',EnforceValueArray:'A value in the array of "{key}" is invalid, it must be a "{type}".',FieldsFormat:"Fields format is invalid. It may either be inclusive or exclusive, but not both.",RecordExists:'A record with ID "{id}" already exists.',Index:"Index",Class:"Class",Properties:"Properties",Include:"Include",QueryOptions:"Query Options",IncludedLabel:"included",NoResults:"No results.",Create:"Create",Update:"Update",Delete:"Delete",True:"True",False:"False",IncludePath:"Path (dot-separated)",Query:"Query",Fields:"Fields",Match:"Match",Sort:"Sort",Field:"Field",Pagination:"Pagination",Limit:"Limit",Offset:"Offset"}},{}],26:[function(e,r,t){"use strict";var n=e("./constants");t.find=n.find,t.create=n.create,t.update=n.update,t.delete=n.delete},{"./constants":18}],27:[function(e,r,t){"use strict";function n(e){return Function("assign","return function "+e+" (x) { assign(this, x) }")(i)}var o=e("error-class"),i=e("./assign");t.OK=n("OK"),t.Created=n("Created"),t.Empty=n("Empty"),t.BadRequestError=o("BadRequestError"),t.UnauthorizedError=o("UnauthorizedError"),t.ForbiddenError=o("ForbiddenError"),t.NotFoundError=o("NotFoundError"),t.MethodError=o("MethodError"),t.NotAcceptableError=o("NotAcceptableError"),t.ConflictError=o("ConflictError"),t.UnsupportedError=o("UnsupportedError"),t.nativeErrors=[Error,TypeError,ReferenceError,RangeError,SyntaxError,EvalError,URIError]},{"./assign":14,"error-class":47}],28:[function(e,r,t){"use strict";var n=e("./response_classes");t.OK=n.OK,t.Created=n.Created,t.Empty=n.Empty},{"./response_classes":27}],29:[function(e,r,t){"use strict";var n=e("../common/message"),o=e("../common/array/unique"),i=e("../common/array/map"),s=e("../common/array/includes"),a=e("../common/errors"),u=a.BadRequestError,f=e("../common/keys"),c=f.primary,l=f.link,p=f.isArray,h=f.inverse;r.exports=function(e,r,t,a){var f=this.adapter,d=this.options.settings.enforceLinks;return Promise.all(i(t,function(t){var p=Array.isArray(e[t])?e[t]:e.hasOwnProperty(t)&&null!==e[t]?[e[t]]:[],y=r[t][l],m=r[t][h],g={fields:{}};return g.fields[m]=!0,new Promise(function(e,r){return p.length?f.find(y,p,g,a).then(function(f){var l,h,y;if(d)for(l=o(i(f,function(e){return e[c]})),h=0,y=p.length;h<y;h++)if(!s(l,p[h]))return r(new u(n("RelatedRecordNotFound",a.language,{field:t})));return e(f)}):e()})})).then(function(e){var n,o,i,s={};for(o=0,i=e.length;o<i;o++)n=e[o],n&&(s[t[o]]=r[t[o]][p]?n:n[0]);return s})}},{"../common/array/includes":9,"../common/array/map":10,"../common/array/unique":13,"../common/errors":20,"../common/keys":24,"../common/message":25}],30:[function(e,r,t){"use strict";var n=e("./validate_records"),o=e("./check_links"),i=e("../record_type/enforce"),s=e("../common/message"),a=e("../common/array/map"),u=e("../common/errors"),f=u.BadRequestError,c=e("./update_helpers"),l=c.getUpdate,p=c.addId,h=e("../common/constants"),d=h.change,y=h.create,m=h.update,g=h.primary,v=h.link,w=h.inverse,b=h.isArray,E=h.denormalizedInverse;r.exports=function(e){var r,t,u,c,h,A,P,T=this,_=T.adapter,R=T.recordTypes,O=T.hooks,k={},I=[];return Promise.resolve(e.request.payload).then(function(r){var n,o,i;if(t=r,!t||!t.length)throw new f(s("CreateRecordsInvalid",P));u=e.request.type,c=e.request.meta,P=c.language,h=O[u],A=R[u];for(i in A)if(v in A[i]&&I.push(i),E in A[i])for(n=0,o=t.length;n<o;n++)delete t[n][i];return _.beginTransaction()}).then(function(n){return e.transaction=r=n,"function"==typeof h[0]?Promise.all(a(t,function(r){return h[0](e,r)})):t}).then(function(e){return Promise.all(a(e,function(e,r){return e?t[r]=e:e=t[r],i(u,e,A,c),o.call(T,e,A,I,c)}))}).then(function(){return n.call(T,t,A,I,c),r.create(u,t,c)}).then(function(n){var o,i,u,h,d,y,m,E,T,_,O,B,S,U={};if(!n.length)throw new f(s("CreateRecordsFail",P));for(t=n,Object.defineProperty(e.response,"records",{configurable:!0,value:t}),o=0,i=t.length;o<i;o++){if(m=t[o],!(g in m))throw new Error(s("CreateRecordMissingID",P));for(u=0,h=I.length;u<h;u++)if(E=I[u],T=A[E][w],m.hasOwnProperty(E)&&T)for(_=A[E][v],O=R[_][T][b],B=Array.isArray(m[E])?m[E]:[m[E]],k[_]||(k[_]=[]),U[_]||(U[_]={}),d=0,y=B.length;d<y;d++)S=B[d],null!==S&&p(m[g],l(_,S,k,U),T,O)}return Promise.all(a(Object.keys(k),function(e){return k[e].length?r.update(e,k[e],c):null}))}).then(function(){return r.endTransaction()}).catch(function(e){throw r&&r.endTransaction(e),e}).then(function(){var r,n={};n[y]={},n[y][u]=t;for(r in k)k[r].length&&(m in n||(n[m]={}),n[m][r]=k[r]);return T.emit(d,n),e})}},{"../common/array/map":10,"../common/constants":18,"../common/errors":20,"../common/message":25,"../record_type/enforce":41,"./check_links":29,"./update_helpers":37,"./validate_records":38}],31:[function(e,r,t){"use strict";var n=e("../common/message"),o=e("../common/array/map"),i=e("../common/errors"),s=i.NotFoundError,a=e("./update_helpers"),u=a.getUpdate,f=a.removeId,c=e("../common/constants"),l=c.change,p=c.delete,h=c.update,d=c.primary,y=c.link,m=c.inverse,g=c.isArray;r.exports=function(e){var r,t,i,a=this,c=e.request,v=c.type,w=c.ids,b=c.meta,E=b.language,A=a.adapter,P=a.recordTypes,T=a.hooks,_={},R=P[v],O=T[v],k=[];for(t in R)y in R[t]&&k.push(t);if(!w||!w.length)throw new s(n("DeleteRecordsMissingID",E));return A.find(v,w,null,b).then(function(r){if(i=r,i.length<w.length)throw new s(n("DeleteRecordsInvalid",E));return Object.defineProperty(e.response,"records",{configurable:!0,value:i}),A.beginTransaction()}).then(function(t){return e.transaction=r=t,"function"==typeof O[0]?Promise.all(o(i,function(r){return O[0](e,r)})):i}).then(function(){return r.delete(v,w,b)}).then(function(e){var t,s,a,c,l,p,h,v,A,T,O,I,B,S={};if(e<w.length)throw new Error(n("DeleteRecordsFail",E));for(t=0,s=i.length;t<s;t++)for(h=i[t],a=0,c=k.length;a<c;a++)if(v=k[a],T=R[v][m],h.hasOwnProperty(v)&&T)for(O=R[v][y],I=P[O][T][g],B=Array.isArray(h[v])?h[v]:[h[v]],_[O]||(_[O]=[]),S[O]||(S[O]={}),l=0,p=B.length;l<p;l++)A=B[l],null!==A&&f(h[d],u(O,A,_,S),T,I);return Promise.all(o(Object.keys(_),function(e){return _[e].length?r.update(e,_[e],b):null}))}).then(function(){return r.endTransaction()}).catch(function(e){throw r&&r.endTransaction(e),e}).then(function(){var r,t={};t[p]={},t[p][v]=w;for(r in _)_[r].length&&(h in t||(t[h]={}),t[h][r]=_[r]);return a.emit(l,t),e})}},{"../common/array/map":10,"../common/constants":18,"../common/errors":20,"../common/message":25,"./update_helpers":37}],32:[function(e,r,t){"use strict";var n=e("../common/array/map");r.exports=function(e){var r=this.hooks,t=e.request,o=e.response,i=t.type,s=r[i],a=o.records,u=o.include;return delete o.records,delete o.include,delete e.transaction,(a?Promise.all(n(a,function(r){return Promise.resolve("function"==typeof s[1]?s[1](e,r):r)})).then(function(t){var o,i,s;for(i=0,s=t.length;i<s;i++)t[i]&&(a[i]=t[i]);if(u)return o=Object.keys(u),Promise.all(n(o,function(t){return Promise.all(n(u[t],function(n){return Promise.resolve("function"==typeof r[t][1]?r[t][1](e,n):n)}))})).then(function(e){var r,t,n,i;for(r=0,t=e.length;r<t;r++)for(n=0,i=e[r].length;n<i;n++)e[r][n]&&(u[o[r]][n]=e[r][n])})}):Promise.resolve()).then(function(){return e.response.payload={records:a},u&&(e.response.payload.include=u),a&&"count"in a&&(e.response.payload.count=a.count),e})}},{"../common/array/map":10}],33:[function(e,r,t){"use strict";r.exports=function(e){var r=this.adapter,t=e.request,n=t.type,o=t.ids,i=t.options,s=t.meta;return n?r.find(n,o,i,s).then(function(r){return Object.defineProperty(e.response,"records",{configurable:!0,value:r}),e}):e}},{}],34:[function(e,r,t){"use strict";function n(e){return function(r){return r[c]===e}}var o=e("../common/array/map"),i=e("../common/array/find"),s=e("../common/array/reduce"),a=e("../common/errors"),u=a.BadRequestError,f=e("../common/keys"),c=f.primary,l=f.link;r.exports=function e(r){var t,a,f,p,h=r.request,d=h.type,y=h.ids||[],e=h.include,m=h.meta,g=r.response,v=g.records,w=this.recordTypes,b=this.adapter,E={};for(E[d]={},t=0,a=y.length;t<a;t++)E[d][y[t]]=!0;if(!d||!e||!v)return r;if(y&&!y.length)for(t=0,a=v.length;t<a;t++)f=v[t],p=f[c],E[d][p]||(E[d][p]=!0);return Promise.all(o(e,function(e){return new Promise(function(r,t){var n,i,a,f,p=d,h=[];return"object"==typeof e[e.length-1]&&(f=e[e.length-1],e=e.slice(0,-1)),Promise.all(o(v,function(r){var t;return r.hasOwnProperty(e[0])?r:(t={fields:{}},t.fields[e[0]]=!0,b.find(d,[r[c]],t,m).then(function(e){return e[0]}))})).then(function(r){return s(e,function(r,t,o){return r.then(function(r){if(a=w[p][t],!p||!a)return[];if(!(l in a))throw new u('The field "'+t+'" does not define a link.');return n={},p=a[l],h=s(r,function(e,r){var o,i,s,a=Array.isArray(r[t])?r[t]:[r[t]];for(o=0,i=a.length;o<i;o++)s=a[o],s&&!n[s]&&(n[s]=!0,e.push(s));return e},[]),o===e.length-1?i=f:(i={fields:{}},i.fields[e[o+1]]=!0),h.length?b.find(p,h,i,m):[]})},Promise.resolve(r))}).then(function(e){return r({type:p,ids:h,records:e})},function(e){return t(e)})})})).then(function(e){var t=s(e,function(e,r){var t,o,s,a;if(!r.ids.length)return e;for(e[r.type]||(e[r.type]=[]),E[r.type]||(E[r.type]={}),t=0,o=r.ids.length;t<o;t++)s=r.ids[t],E[r.type][s]||(a=i(r.records,n(s)),a&&(E[r.type][s]=!0,e[r.type].push(a)));return e[r.type].length||delete e[r.type],e},{});return Object.keys(t).length&&Object.defineProperty(r.response,"include",{configurable:!0,value:t}),r})}},{"../common/array/find":8,"../common/array/map":10,"../common/array/reduce":12,"../common/errors":20,"../common/keys":24}],35:[function(e,r,t){"use strict";function n(e,r){var t=e.flows,n=e.recordTypes,u=o(r);return Promise.resolve(u).then(function(e){var r,o,i,u,p,h=e.request.method,d=e.request.type,y=e.request.ids,m=e.request.meta.language;if(m=e.request.meta.language,y&&(e.request.ids=s(y)),null===d)throw i=new f(a("UnspecifiedType",m)),i.isTypeUnspecified=!0,i;if(!n.hasOwnProperty(d))throw new c(a("InvalidType",m,{type:d}));if(!(h in t))throw new l(a("InvalidMethod",m,{method:h}));for(r=Promise.resolve(e),o=t[h],u=0,p=o.length;u<p;u++)r=r.then(o[u]);return r}).then(function(e){var r=e.request.method,t=e.response,n=t.payload;return n?r===g?new d(t):new p(t):new h(t)}).catch(function(e){throw i(e,u.response)})}function o(e){var r={request:{method:m,type:null,ids:null,options:{},include:[],meta:{},payload:null},response:{meta:{},payload:null}};return i(r.request,e),r}var i=e("../common/assign"),s=e("../common/array/unique"),a=e("../common/message"),u=e("../common/response_classes"),f=u.BadRequestError,c=u.NotFoundError,l=u.MethodError,p=u.OK,h=u.Empty,d=u.Created,y=e("../common/methods"),m=y.find,g=y.create;n.middlewares={create:e("./create"),delete:e("./delete"),update:e("./update"),find:e("./find"),include:e("./include"),end:e("./end")},r.exports=n},{"../common/array/unique":13,"../common/assign":14,"../common/message":25,"../common/methods":26,"../common/response_classes":27,"./create":30,"./delete":31,"./end":32,"./find":33,"./include":34,"./update":36}],36:[function(e,r,t){"use strict";function n(e,r){var t,n,o,i=r.language;if(!e||!e.length)throw new w(l("UpdateRecordsInvalid",i));for(t=0,n=e.length;t<n;t++)if(o=e[t],!o[R])throw new w(l("UpdateRecordMissingID",i))}function o(e,r){var t;for(t in e.replace)r.hasOwnProperty(t)||delete e.replace[t];for(t in e.pull)r.hasOwnProperty(t)||delete e.pull[t];for(t in e.push)r.hasOwnProperty(t)||delete e.push[t]}var i=e("../common/deep_equal"),s=e("../common/assign"),a=e("../common/clone"),u=e("./validate_records"),f=e("./check_links"),c=e("../record_type/enforce"),l=e("../common/message"),p=e("../common/apply_update"),h=e("./update_helpers"),d=h.getUpdate,y=h.addId,m=h.removeId,g=e("../common/errors"),v=g.NotFoundError,w=g.BadRequestError,b=e("../common/array/find"),E=e("../common/array/includes"),A=e("../common/array/map"),P=e("../common/constants"),T=P.change,_=P.update,R=P.primary,O=P.link,k=P.inverse,I=P.isArray,B=P.denormalizedInverse;r.exports=function(e){var r,t,h,g,P,S,U,x=this,D=x.adapter,C=x.recordTypes,q=x.hooks,j=new WeakMap,M=new WeakMap,N={},Y=[],L=[];return Promise.resolve(e.request.payload).then(function(r){var o,i,s,a;t=r,n(t,e.request.meta),P=e.request.type,S=e.request.meta,U=S.language,h=C[P],g=q[P];for(a in h)if(O in h[a]&&L.push(a),B in h[a])for(o=0,i=t.length;o<i;o++)s=t[o],s.replace&&delete s.replace[a],s.pull&&delete s.pull[a],s.push&&delete s.push[a];return D.beginTransaction()}).then(function(n){return e.transaction=r=n,D.find(P,A(t,function(e){return e[R]}),null,S)}).then(function(r){if(r.length<t.length)throw new v(l("UpdateRecordMissing",U));return Promise.all(A(r,function(r){var n,o,u="function"==typeof g[0],d=r[R];if(n=b(t,function(e){return e[R]===d}),!n)throw new v(l("UpdateRecordMissing",U));return u&&(o=a(n)),Promise.resolve(u?g[0](e,r,n):n).then(function(t){if(t&&(n=t),u&&(i(n,o)||(e.response.meta.updateModified=!0),n[R]!==d))throw new w(l("InvalidID",U));return Y.push(n),j.set(n,r),r=s({},r),p(r,n),n.operate&&(r=D.applyOperators(r,n.operate)),c(P,r,h,S),f.call(x,r,h,L,S).then(function(e){return M.set(n,e),r})})}))}).then(function(t){var n,i;for(u.call(x,t,h,L,S),Object.defineProperty(e.response,"records",{configurable:!0,value:t}),n=0,i=Y.length;n<i;n++)o(Y[n],h);return r.update(P,Y,S)}).then(function(){var e,t,n,o,i,s,a,u,f,c,l,p,g,v,w,b,T,_,B,U,x={};for(w=0,b=Y.length;w<b;w++)for(g=Y[w],T=0,_=L.length;T<_;T++)if(v=L[T],e=h[v][k]){if(t=h[v][I],n=h[v][O],o=C[n][e][I],N[n]||(N[n]=[]),x[n]||(x[n]={}),s=j.get(g),i=M.get(g),g.replace&&g.replace.hasOwnProperty(v)){if(c=g.replace[v],!Array.isArray(c)){if(c===s[v])continue;null!==c&&y(g[R],d(n,c,N,x),e,o),i.hasOwnProperty(v)&&null!==i[v][e]&&!o&&i[v][e]!==g[R]&&m(c,d(n,i[v][e],N,x),e,o),null!==s[v]&&s[v]!==g[v]&&s[v]!==c&&m(g[R],d(n,s[v],N,x),e,o);continue}for(f=c,B=0,U=s[v].length;B<U;B++)if(c=s[v][B],!E(f,c)){if("pull"in g||(g.pull={}),g.pull.hasOwnProperty(v)){if(Array.isArray(g.pull[v])){g.pull[v].push(c);continue}g.pull[v]=[g.pull[v],c];continue}g.pull[v]=[c]}for(B=0,U=f.length;B<U;B++)if(c=f[B],!E(s[v],c)){if("push"in g||(g.push={}),g.push.hasOwnProperty(v)){if(Array.isArray(g.push[v])){g.push[v].push(c);continue}g.push[v]=[g.push[v],c];continue}g.push[v]=[c]}delete g.replace[v]}if(g.pull&&g.pull[v])for(p=Array.isArray(g.pull[v])?g.pull[v]:[g.pull[v]],B=0,U=p.length;B<U;B++)c=p[B],null!==c&&m(g[R],d(n,c,N,x),e,o);if(g.push&&g.push[v])for(l=Array.isArray(g.push[v])?g.push[v]:[g.push[v]],B=0,U=l.length;B<U;B++)c=l[B],null!==c&&y(g[R],d(n,c,N,x),e,o);if(i.hasOwnProperty(v)&&!o)for(u=Array.isArray(i[v])?i[v]:[i[v]],B=0,U=u.length;B<U;B++)a=u[B],a[e]!==g[R]&&m(a[R],d(P,a[e],N,x),v,t)}return Promise.all(A(Object.keys(N),function(e){return N[e].length?r.update(e,N[e],S):null}))}).then(function(){return r.endTransaction()}).catch(function(e){throw r&&r.endTransaction(e),e}).then(function(){var r,t={};t[_]={},t[_][P]=Y;for(r in N)N[r].length&&(r!==P?t[_][r]=N[r]:t[_][P]=t[_][P].concat(N[P]));return x.emit(T,t),e})}},{"../common/apply_update":6,"../common/array/find":8,"../common/array/includes":9,"../common/array/map":10,"../common/assign":14,"../common/clone":17,"../common/constants":18,"../common/deep_equal":19,"../common/errors":20,"../common/message":25,"../record_type/enforce":41,"./check_links":29,"./update_helpers":37,"./validate_records":38}],37:[function(e,r,t){"use strict";var n=e("../common/array/find"),o=e("../common/keys"),i=o.primary;t.getUpdate=function(e,r,t,o){var s;return o[e]&&o[e][r]?n(t[e],function(e){return e[i]===r}):(s={id:r},t[e]||(t[e]=[]),t[e].push(s),o[e]={},o[e][r]=!0,s)},t.addId=function(e,r,t,n){return n?(r.push||(r.push={}),r.push[t]||(r.push[t]=[]),void r.push[t].push(e)):(r.replace||(r.replace={}),void(r.replace[t]=e))},t.removeId=function(e,r,t,n){return n?(r.pull||(r.pull={}),r.pull[t]||(r.pull[t]=[]),void r.pull[t].push(e)):(r.replace||(r.replace={}),void(r.replace[t]=null))}},{"../common/array/find":8,"../common/keys":24}],38:[function(e,r,t){"use strict";var n=e("../common/message"),o=e("../common/errors"),i=o.ConflictError,s=e("../common/keys"),a=s.link,u=s.isArray,f=s.inverse;r.exports=function(e,r,t,o){var s,c,l,p,h,d,y,m,g,v,w,b,E,A,P,T,_=this.recordTypes,R=o.language,O={};for(s=0,c=t.length;s<c;s++){if(m=t[s],E=r[m][a],A=r[m][f],P=r[m][u],T=_[E][A][u],P)for(l=0,p=e.length;l<p;l++)if(g=e[l],Array.isArray(g[m]))for(w=g[m],b={},h=0,d=w.length;h<d;h++){if(v=w[h],b.hasOwnProperty(v))throw new i(n("CollisionDuplicate",R,{id:v,field:m}));b[v]=!0}if(!T)for(O[m]={},l=0,p=e.length;l<p;l++)for(g=e[l],y=g[m],w=Array.isArray(y)?y:y?[y]:[],h=0,d=w.length;h<d;h++){if(v=w[h],O[m].hasOwnProperty(v))throw new i(n("CollisionToOne",R,{
field:m}));O[m][v]=!0}}}},{"../common/errors":20,"../common/keys":24,"../common/message":25}],39:[function(e,r,t){"use strict";window.fortune=e("./")},{"./":40}],40:[function(e,r,t){"use strict";function n(e,r){return this instanceof n?void this.constructor(e,r):new n(e,r)}function o(e,r){return function(t){return r.call(e,t)}}var i=e("event-lite"),s=e("./adapter/adapters/memory"),a=e("./adapter/singleton"),u=e("./record_type/validate"),f=e("./record_type/ensure_types"),c=e("./dispatch"),l=c.middlewares,p=e("./adapter"),h=e("./common"),d=h.assign,y=h.methods,m=h.events,g={};n.prototype=Object.create(i.prototype),n.prototype.constructor=function(e,r){var t,n,i,f,c,h,d,m,v=this;void 0===e&&(e={}),void 0===r&&(r={}),"adapter"in r||(r.adapter=[s(p)]),"settings"in r||(r.settings={}),"hooks"in r||(r.hooks={}),"enforceLinks"in r.settings||(r.settings.enforceLinks=!0),f={};for(n in y){for(i=[l[n],l.include,l.end],d=0,m=i.length;d<m;d++)i[d]=o(v,i[d]);f[y[n]]=i}h=r.hooks;for(c in h){if(!e.hasOwnProperty(c))throw new Error('Attempted to define hook on "'+c+'" type which does not exist.');if(!Array.isArray(h[c]))throw new TypeError('Hook value for "'+c+'" type must be an array.')}for(c in e){if(c in g)throw new Error('Can not define type name "'+c+'" which is in Object.prototype.');u(e[c]),h.hasOwnProperty(c)||(h[c]=[])}t=new a({adapter:r.adapter,recordTypes:e,hooks:h}),Object.defineProperties(v,{connectionStatus:{value:0,writable:!0},options:{value:r},hooks:{value:h},recordTypes:{value:e,enumerable:!0},adapter:{value:t,enumerable:!0,configurable:!0},flows:{value:f}})},n.prototype.request=function(e){var r=this,t=r.connectionStatus;return 0===t?r.connect().then(function(){return c(r,e)}):1===t?new Promise(function(t,n){r.once(m.failure,function(){n(new Error("Connection failed."))}),r.once(m.connect,function(){t(c(r,e))})}):c(r,e)},n.prototype.find=function(){var e={method:y.find,type:arguments[0]};return null!=arguments[1]&&(e.ids=Array.isArray(arguments[1])?arguments[1]:[arguments[1]]),null!=arguments[2]&&(e.options=arguments[2]),null!=arguments[3]&&(e.include=arguments[3]),null!=arguments[4]&&(e.meta=arguments[4]),this.request(e)},n.prototype.create=function(){var e={method:y.create,type:arguments[0],payload:Array.isArray(arguments[1])?arguments[1]:[arguments[1]]};return null!=arguments[2]&&(e.include=arguments[2]),null!=arguments[3]&&(e.meta=arguments[3]),this.request(e)},n.prototype.update=function(){var e={method:y.update,type:arguments[0],payload:Array.isArray(arguments[1])?arguments[1]:[arguments[1]]};return null!=arguments[2]&&(e.include=arguments[2]),null!=arguments[3]&&(e.meta=arguments[3]),this.request(e)},n.prototype.delete=function(){var e={method:y.delete,type:arguments[0]};return null!=arguments[1]&&(e.ids=Array.isArray(arguments[1])?arguments[1]:[arguments[1]]),null!=arguments[2]&&(e.include=arguments[2]),null!=arguments[3]&&(e.meta=arguments[3]),this.request(e)},n.prototype.connect=function(){var e=this;return 1===e.connectionStatus?Promise.reject(new Error("Connection is in progress.")):2===e.connectionStatus?Promise.reject(new Error("Connection is already done.")):(e.connectionStatus=1,new Promise(function(r,t){f(e.recordTypes),e.adapter.connect().then(function(){return e.connectionStatus=2,e.emit(m.connect),r(e)},function(r){return e.connectionStatus=0,e.emit(m.failure),t(r)})}))},n.prototype.disconnect=function(){var e=this;return 2!==e.connectionStatus?Promise.reject(new Error("Instance has not been connected.")):(e.connectionStatus=1,new Promise(function(r,t){return e.adapter.disconnect().then(function(){return e.connectionStatus=0,e.emit(m.disconnect),r(e)},function(r){return e.connectionStatus=2,e.emit(m.failure),t(r)})}))},n.prototype.common=h,d(n,{Adapter:p,adapters:{memory:s(p)},errors:h.errors,message:h.message,methods:y,events:m}),r.exports=n},{"./adapter":4,"./adapter/adapters/memory":3,"./adapter/singleton":5,"./common":23,"./dispatch":35,"./record_type/ensure_types":42,"./record_type/validate":43,"event-lite":48}],41:[function(e,r,t){(function(t){"use strict";function n(e,r,t,n){var o,a=n.language;if(null!==t&&(o=s(d,function(r){return r[0]===e[l]}),o=o?o[1]:e[l],!o(t)))throw new u(i(e[h]?"EnforceValueArray":"EnforceValue",a,{key:r,type:e[l].name}))}function o(e){return function(r){return e===r}}var i=e("../common/message"),s=e("../common/array/find"),a=e("../common/errors"),u=a.BadRequestError,f=e("../common/keys"),c=f.primary,l=f.type,p=f.link,h=f.isArray,d=[[String,function(e){return"string"==typeof e}],[Number,function(e){return"number"==typeof e}],[Boolean,function(e){return"boolean"==typeof e}],[Date,function(e){return e&&"function"==typeof e.getTime&&!Number.isNaN(e.getTime())}],[Object,function(e){return null!==e&&"object"==typeof e}],[t,function(e){return t.isBuffer(e)}]];r.exports=function(e,r,t,a){var f,d,y,m,g,v;a||(a={}),v=a.language;for(y in r)if(g=t[y])if(m=r[y],g[l])if(g[h]){if(!Array.isArray(m))throw new u(i("EnforceArrayType",v,{key:y,type:g[l].name}));for(f=0,d=m.length;f<d;f++)n(g,y,m[f],a)}else n(g,y,m,a);else if(g[p]){if(g[h]){if(!Array.isArray(m))throw new u(i("EnforceArray",v,{key:y}));if(e===g[p]&&s(m,o(r[c])))throw new u(i("EnforceSameID",v,{key:y}));continue}if(Array.isArray(m))throw new u(i("EnforceSingular",v,{key:y}));if(e===g[p]&&r[c]===m)throw new u(i("EnforceSameID",v,{key:y}))}else;else y!==c&&delete r[y];return r}}).call(this,e("buffer").Buffer)},{"../common/array/find":8,"../common/errors":20,"../common/keys":24,"../common/message":25,buffer:45}],42:[function(e,r,t){"use strict";var n=e("../common/keys"),o=n.link,i=n.inverse,s=n.isArray,a=n.denormalizedInverse,u="__",f="_",c="_inverse";r.exports=function(e){var r,t,n,l,p,h;for(r in e)for(t in e[r])if(n=e[r][t],o in n){if(!e.hasOwnProperty(n[o]))throw new Error('The value for "'+o+'" on "'+t+'" in type "'+r+'" is invalid, the record type does not exist.');if(l=e[n[o]],i in n){if(!l.hasOwnProperty(n[i]))throw new Error('The value for "'+i+'" on "'+t+'" in type "'+r+'" is invalid, the field does not exist.');if(l[n[i]][i]!==t)throw new Error('The value for "'+i+'" on "'+t+'" in type "'+r+'" is invalid, the inversely related field must define its inverse as "'+t+'".');if(l[n[i]][o]!==r)throw new Error('The value for "'+o+'" on "'+t+'" in type "'+r+'" is invalid, the inversely related field must define its link as "'+r+'".')}else p=u+r+f+t+c,Object.defineProperty(n,i,{value:p}),h={},h[o]=r,h[i]=t,h[s]=!0,h[a]=!0,Object.defineProperty(l,p,{value:h})}}},{"../common/keys":24}],43:[function(e,r,t){(function(t){"use strict";function n(e,r){var t=e[r]=o(e[r]);if("object"!=typeof t||t.constructor!==Object)throw new TypeError('The definition of "'+r+'" must be an object.');if(r===a)throw new Error('Can not define primary key "'+a+'".');if(r in h)throw new Error('Can not define field name "'+r+'" which is in Object.prototype.');if(!t[u]&&!t[f])throw new Error('The definition of "'+r+'" must contain either the "'+u+'" or "'+f+'" property.');if(t[u]&&t[f])throw new Error('Can not define both "'+u+'" and "'+f+'" on "'+r+'".');if(t[u]){if(!i(p,function(e){return e===t[u]})&&"function"!=typeof t[u])throw new Error('The "'+u+'" on "'+r+'" is invalid.');if("function"==typeof t[u]&&!i(p,function(e){return e===t[u].prototype.constructor}))throw new Error('The "'+u+'" on "'+r+'" must inherit from a valid native type.');if(t[c])throw new Error('The field "'+c+'" may not be defined on "'+r+'".')}if(t[f]){if("string"!=typeof t[f])throw new TypeError('The "'+f+'" on "'+r+'" must be a string.');if(t[c]&&"string"!=typeof t[c])throw new TypeError('The "'+c+'" on "'+r+'" must be a string.')}if(t[l]&&"boolean"!=typeof t[l])throw new TypeError('The key "'+l+'" on "'+r+'" must be a boolean.')}function o(e){var r;if("string"==typeof e)r={link:e};else if("function"==typeof e)r={type:e};else{if(!Array.isArray(e))return e;r={},e[1]?r.inverse=e[1]:r.isArray=!0,Array.isArray(e[0])?(r.isArray=!0,e=e[0][0]):e=e[0],"string"==typeof e?r.link=e:"function"==typeof e&&(r.type=e)}return r}var i=e("../common/array/find"),s=e("../common/keys"),a=s.primary,u=s.type,f=s.link,c=s.inverse,l=s.isArray,p=[String,Number,Boolean,Date,Object,t],h={};r.exports=function(e){var r;if("object"!=typeof e)throw new TypeError("Type definition must be an object.");for(r in e)n(e,r);return e}}).call(this,e("buffer").Buffer)},{"../common/array/find":8,"../common/keys":24,buffer:45}],44:[function(e,r,t){"use strict";function n(e){var r=e.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[r-2]?2:"="===e[r-1]?1:0}function o(e){return 3*e.length/4-n(e)}function i(e){var r,t,o,i,s,a,u=e.length;s=n(e),a=new l(3*u/4-s),o=s>0?u-4:u;var f=0;for(r=0,t=0;r<o;r+=4,t+=3)i=c[e.charCodeAt(r)]<<18|c[e.charCodeAt(r+1)]<<12|c[e.charCodeAt(r+2)]<<6|c[e.charCodeAt(r+3)],a[f++]=i>>16&255,a[f++]=i>>8&255,a[f++]=255&i;return 2===s?(i=c[e.charCodeAt(r)]<<2|c[e.charCodeAt(r+1)]>>4,a[f++]=255&i):1===s&&(i=c[e.charCodeAt(r)]<<10|c[e.charCodeAt(r+1)]<<4|c[e.charCodeAt(r+2)]>>2,a[f++]=i>>8&255,a[f++]=255&i),a}function s(e){return f[e>>18&63]+f[e>>12&63]+f[e>>6&63]+f[63&e]}function a(e,r,t){for(var n,o=[],i=r;i<t;i+=3)n=(e[i]<<16)+(e[i+1]<<8)+e[i+2],o.push(s(n));return o.join("")}function u(e){for(var r,t=e.length,n=t%3,o="",i=[],s=16383,u=0,c=t-n;u<c;u+=s)i.push(a(e,u,u+s>c?c:u+s));return 1===n?(r=e[t-1],o+=f[r>>2],o+=f[r<<4&63],o+="=="):2===n&&(r=(e[t-2]<<8)+e[t-1],o+=f[r>>10],o+=f[r>>4&63],o+=f[r<<2&63],o+="="),i.push(o),i.join("")}t.byteLength=o,t.toByteArray=i,t.fromByteArray=u;for(var f=[],c=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,d=p.length;h<d;++h)f[h]=p[h],c[p.charCodeAt(h)]=h;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],45:[function(e,r,t){(function(r){"use strict";function n(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function o(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,r){if(o()<r)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(r),e.__proto__=s.prototype):(null===e&&(e=new s(r)),e.length=r),e}function s(e,r,t){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(e,r,t);if("number"==typeof e){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return a(this,e,r,t)}function a(e,r,t,n){if("number"==typeof r)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?h(e,r,t,n):"string"==typeof r?l(e,r,t):d(e,r)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,r,t,n){return u(r),r<=0?i(e,r):void 0!==t?"string"==typeof n?i(e,r).fill(t,n):i(e,r).fill(t):i(e,r)}function c(e,r){if(u(r),e=i(e,r<0?0:0|y(r)),!s.TYPED_ARRAY_SUPPORT)for(var t=0;t<r;++t)e[t]=0;return e}function l(e,r,t){if("string"==typeof t&&""!==t||(t="utf8"),!s.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var n=0|g(r,t);e=i(e,n);var o=e.write(r,t);return o!==n&&(e=e.slice(0,o)),e}function p(e,r){var t=r.length<0?0:0|y(r.length);e=i(e,t);for(var n=0;n<t;n+=1)e[n]=255&r[n];return e}function h(e,r,t,n){if(r.byteLength,t<0||r.byteLength<t)throw new RangeError("'offset' is out of bounds");if(r.byteLength<t+(n||0))throw new RangeError("'length' is out of bounds");return r=void 0===t&&void 0===n?new Uint8Array(r):void 0===n?new Uint8Array(r,t):new Uint8Array(r,t,n),s.TYPED_ARRAY_SUPPORT?(e=r,e.__proto__=s.prototype):e=p(e,r),e}function d(e,r){if(s.isBuffer(r)){var t=0|y(r.length);return e=i(e,t),0===e.length?e:(r.copy(e,0,0,t),e)}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||X(r.length)?i(e,0):p(e,r);if("Buffer"===r.type&&$(r.data))return p(e,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function y(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function m(e){return+e!=e&&(e=0),s.alloc(+e)}function g(e,r){if(s.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var t=e.length;if(0===t)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":case void 0:return J(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*t;case"hex":return t>>>1;case"base64":return G(e).length;default:if(n)return J(e).length;r=(""+r).toLowerCase(),n=!0}}function v(e,r,t){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length)return"";if((void 0===t||t>this.length)&&(t=this.length),t<=0)return"";if(t>>>=0,r>>>=0,t<=r)return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,r,t);case"utf8":case"utf-8":return I(this,r,t);case"ascii":return S(this,r,t);case"latin1":case"binary":return U(this,r,t);case"base64":return k(this,r,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,r,t);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function w(e,r,t){var n=e[r];e[r]=e[t],e[t]=n}function b(e,r,t,n,o){if(0===e.length)return-1;if("string"==typeof t?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,isNaN(t)&&(t=o?0:e.length-1),t<0&&(t=e.length+t),t>=e.length){if(o)return-1;t=e.length-1}else if(t<0){if(!o)return-1;t=0}if("string"==typeof r&&(r=s.from(r,n)),s.isBuffer(r))return 0===r.length?-1:E(e,r,t,n,o);if("number"==typeof r)return r&=255,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,r,t):Uint8Array.prototype.lastIndexOf.call(e,r,t):E(e,[r],t,n,o);throw new TypeError("val must be string, number or Buffer")}function E(e,r,t,n,o){function i(e,r){return 1===s?e[r]:e.readUInt16BE(r*s)}var s=1,a=e.length,u=r.length;if(void 0!==n&&(n=String(n).toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||r.length<2)return-1;s=2,a/=2,u/=2,t/=2}var f;if(o){var c=-1;for(f=t;f<a;f++)if(i(e,f)===i(r,c===-1?0:f-c)){if(c===-1&&(c=f),f-c+1===u)return c*s}else c!==-1&&(f-=f-c),c=-1}else for(t+u>a&&(t=a-u),f=t;f>=0;f--){for(var l=!0,p=0;p<u;p++)if(i(e,f+p)!==i(r,p)){l=!1;break}if(l)return f}return-1}function A(e,r,t,n){t=Number(t)||0;var o=e.length-t;n?(n=Number(n),n>o&&(n=o)):n=o;var i=r.length;if(i%2!==0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(r.substr(2*s,2),16);if(isNaN(a))return s;e[t+s]=a}return s}function P(e,r,t,n){return W(J(r,e.length-t),e,t,n)}function T(e,r,t,n){return W(K(r),e,t,n)}function _(e,r,t,n){return T(e,r,t,n)}function R(e,r,t,n){return W(G(r),e,t,n)}function O(e,r,t,n){return W(Q(r,e.length-t),e,t,n)}function k(e,r,t){return 0===r&&t===e.length?H.fromByteArray(e):H.fromByteArray(e.slice(r,t))}function I(e,r,t){t=Math.min(e.length,t);for(var n=[],o=r;o<t;){var i=e[o],s=null,a=i>239?4:i>223?3:i>191?2:1;if(o+a<=t){var u,f,c,l;switch(a){case 1:i<128&&(s=i);break;case 2:u=e[o+1],128===(192&u)&&(l=(31&i)<<6|63&u,l>127&&(s=l));break;case 3:u=e[o+1],f=e[o+2],128===(192&u)&&128===(192&f)&&(l=(15&i)<<12|(63&u)<<6|63&f,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:u=e[o+1],f=e[o+2],c=e[o+3],128===(192&u)&&128===(192&f)&&128===(192&c)&&(l=(15&i)<<18|(63&u)<<12|(63&f)<<6|63&c,l>65535&&l<1114112&&(s=l))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),o+=a}return B(n)}function B(e){var r=e.length;if(r<=ee)return String.fromCharCode.apply(String,e);for(var t="",n=0;n<r;)t+=String.fromCharCode.apply(String,e.slice(n,n+=ee));return t}function S(e,r,t){var n="";t=Math.min(e.length,t);for(var o=r;o<t;++o)n+=String.fromCharCode(127&e[o]);return n}function U(e,r,t){var n="";t=Math.min(e.length,t);for(var o=r;o<t;++o)n+=String.fromCharCode(e[o]);return n}function x(e,r,t){var n=e.length;(!r||r<0)&&(r=0),(!t||t<0||t>n)&&(t=n);for(var o="",i=r;i<t;++i)o+=V(e[i]);return o}function D(e,r,t){for(var n=e.slice(r,t),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function C(e,r,t){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+r>t)throw new RangeError("Trying to access beyond buffer length")}function q(e,r,t,n,o,i){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>o||r<i)throw new RangeError('"value" argument is out of bounds');if(t+n>e.length)throw new RangeError("Index out of range")}function j(e,r,t,n){r<0&&(r=65535+r+1);for(var o=0,i=Math.min(e.length-t,2);o<i;++o)e[t+o]=(r&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function M(e,r,t,n){r<0&&(r=4294967295+r+1);for(var o=0,i=Math.min(e.length-t,4);o<i;++o)e[t+o]=r>>>8*(n?o:3-o)&255}function N(e,r,t,n,o,i){if(t+n>e.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Y(e,r,t,n,o){return o||N(e,r,t,4,3.4028234663852886e38,-3.4028234663852886e38),Z.write(e,r,t,n,23,4),t+4}function L(e,r,t,n,o){return o||N(e,r,t,8,1.7976931348623157e308,-1.7976931348623157e308),Z.write(e,r,t,n,52,8),t+8}function F(e){if(e=z(e).replace(re,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function z(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function V(e){return e<16?"0"+e.toString(16):e.toString(16)}function J(e,r){r=r||1/0;for(var t,n=e.length,o=null,i=[],s=0;s<n;++s){if(t=e.charCodeAt(s),t>55295&&t<57344){if(!o){if(t>56319){(r-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(r-=3)>-1&&i.push(239,191,189);continue}o=t;continue}if(t<56320){(r-=3)>-1&&i.push(239,191,189),o=t;continue}t=(o-55296<<10|t-56320)+65536}else o&&(r-=3)>-1&&i.push(239,191,189);if(o=null,t<128){if((r-=1)<0)break;i.push(t)}else if(t<2048){if((r-=2)<0)break;i.push(t>>6|192,63&t|128)}else if(t<65536){if((r-=3)<0)break;i.push(t>>12|224,t>>6&63|128,63&t|128)}else{if(!(t<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,63&t|128)}}return i}function K(e){for(var r=[],t=0;t<e.length;++t)r.push(255&e.charCodeAt(t));return r}function Q(e,r){for(var t,n,o,i=[],s=0;s<e.length&&!((r-=2)<0);++s)t=e.charCodeAt(s),n=t>>8,o=t%256,i.push(o),i.push(n);return i}function G(e){return H.toByteArray(F(e))}function W(e,r,t,n){for(var o=0;o<n&&!(o+t>=r.length||o>=e.length);++o)r[o+t]=e[o];return o}function X(e){return e!==e}var H=e("base64-js"),Z=e("ieee754"),$=e("isarray");t.Buffer=s,t.SlowBuffer=m,t.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==r.TYPED_ARRAY_SUPPORT?r.TYPED_ARRAY_SUPPORT:n(),t.kMaxLength=o(),s.poolSize=8192,s._augment=function(e){return e.__proto__=s.prototype,e},s.from=function(e,r,t){return a(null,e,r,t)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(e,r,t){return f(null,e,r,t)},s.allocUnsafe=function(e){return c(null,e)},s.allocUnsafeSlow=function(e){return c(null,e)},s.isBuffer=function(e){return!(null==e||!e._isBuffer)},s.compare=function(e,r){if(!s.isBuffer(e)||!s.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(e===r)return 0;for(var t=e.length,n=r.length,o=0,i=Math.min(t,n);o<i;++o)if(e[o]!==r[o]){t=e[o],n=r[o];break}return t<n?-1:n<t?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,r){if(!$(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var t;if(void 0===r)for(r=0,t=0;t<e.length;++t)r+=e[t].length;var n=s.allocUnsafe(r),o=0;for(t=0;t<e.length;++t){var i=e[t];if(!s.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},s.byteLength=g,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)w(this,r,r+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)w(this,r,r+3),w(this,r+1,r+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)w(this,r,r+7),w(this,r+1,r+6),w(this,r+2,r+5),w(this,r+3,r+4);return this},s.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):v.apply(this,arguments)},s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},s.prototype.compare=function(e,r,t,n,o){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===t&&(t=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),r<0||t>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&r>=t)return 0;if(n>=o)return-1;if(r>=t)return 1;if(r>>>=0,t>>>=0,n>>>=0,o>>>=0,this===e)return 0;for(var i=o-n,a=t-r,u=Math.min(i,a),f=this.slice(n,o),c=e.slice(r,t),l=0;l<u;++l)if(f[l]!==c[l]){i=f[l],a=c[l];break}return i<a?-1:a<i?1:0},s.prototype.includes=function(e,r,t){return this.indexOf(e,r,t)!==-1},s.prototype.indexOf=function(e,r,t){return b(this,e,r,t,!0)},s.prototype.lastIndexOf=function(e,r,t){return b(this,e,r,t,!1)},s.prototype.write=function(e,r,t,n){if(void 0===r)n="utf8",t=this.length,r=0;else if(void 0===t&&"string"==typeof r)n=r,t=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r|=0,isFinite(t)?(t|=0,void 0===n&&(n="utf8")):(n=t,t=void 0)}var o=this.length-r;if((void 0===t||t>o)&&(t=o),e.length>0&&(t<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return A(this,e,r,t);case"utf8":case"utf-8":return P(this,e,r,t);case"ascii":return T(this,e,r,t);case"latin1":case"binary":return _(this,e,r,t);case"base64":return R(this,e,r,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,r,t);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;s.prototype.slice=function(e,r){var t=this.length;e=~~e,r=void 0===r?t:~~r,e<0?(e+=t,e<0&&(e=0)):e>t&&(e=t),r<0?(r+=t,r<0&&(r=0)):r>t&&(r=t),r<e&&(r=e);var n;if(s.TYPED_ARRAY_SUPPORT)n=this.subarray(e,r),n.__proto__=s.prototype;else{var o=r-e;n=new s(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+e]}return n},s.prototype.readUIntLE=function(e,r,t){e|=0,r|=0,t||C(e,r,this.length);for(var n=this[e],o=1,i=0;++i<r&&(o*=256);)n+=this[e+i]*o;return n},s.prototype.readUIntBE=function(e,r,t){e|=0,r|=0,t||C(e,r,this.length);for(var n=this[e+--r],o=1;r>0&&(o*=256);)n+=this[e+--r]*o;return n},s.prototype.readUInt8=function(e,r){return r||C(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,r){return r||C(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,r){return r||C(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,r){return r||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,r){return r||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,r,t){e|=0,r|=0,t||C(e,r,this.length);for(var n=this[e],o=1,i=0;++i<r&&(o*=256);)n+=this[e+i]*o;return o*=128,n>=o&&(n-=Math.pow(2,8*r)),n},s.prototype.readIntBE=function(e,r,t){e|=0,r|=0,t||C(e,r,this.length);for(var n=r,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*r)),i},s.prototype.readInt8=function(e,r){return r||C(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},s.prototype.readInt16LE=function(e,r){r||C(e,2,this.length);var t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},s.prototype.readInt16BE=function(e,r){r||C(e,2,this.length);var t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},s.prototype.readInt32LE=function(e,r){return r||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,r){return r||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,r){return r||C(e,4,this.length),Z.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,r){return r||C(e,4,this.length),Z.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,r){return r||C(e,8,this.length),Z.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,r){return r||C(e,8,this.length),Z.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,r,t,n){if(e=+e,r|=0,t|=0,!n){var o=Math.pow(2,8*t)-1;q(this,e,r,t,o,0)}var i=1,s=0;for(this[r]=255&e;++s<t&&(i*=256);)this[r+s]=e/i&255;return r+t},s.prototype.writeUIntBE=function(e,r,t,n){if(e=+e,r|=0,t|=0,!n){var o=Math.pow(2,8*t)-1;q(this,e,r,t,o,0)}var i=t-1,s=1;for(this[r+i]=255&e;--i>=0&&(s*=256);)this[r+i]=e/s&255;return r+t},s.prototype.writeUInt8=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,1,255,0),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[r]=255&e,r+1},s.prototype.writeUInt16LE=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[r]=255&e,this[r+1]=e>>>8):j(this,e,r,!0),r+2},s.prototype.writeUInt16BE=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[r]=e>>>8,this[r+1]=255&e):j(this,e,r,!1),r+2},s.prototype.writeUInt32LE=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=255&e):M(this,e,r,!0),r+4},s.prototype.writeUInt32BE=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e):M(this,e,r,!1),r+4},s.prototype.writeIntLE=function(e,r,t,n){if(e=+e,r|=0,!n){var o=Math.pow(2,8*t-1);q(this,e,r,t,o-1,-o)}var i=0,s=1,a=0;for(this[r]=255&e;++i<t&&(s*=256);)e<0&&0===a&&0!==this[r+i-1]&&(a=1),this[r+i]=(e/s>>0)-a&255;return r+t},s.prototype.writeIntBE=function(e,r,t,n){if(e=+e,r|=0,!n){var o=Math.pow(2,8*t-1);q(this,e,r,t,o-1,-o)}var i=t-1,s=1,a=0;for(this[r+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[r+i+1]&&(a=1),this[r+i]=(e/s>>0)-a&255;return r+t},s.prototype.writeInt8=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,1,127,-128),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[r]=255&e,r+1},s.prototype.writeInt16LE=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[r]=255&e,this[r+1]=e>>>8):j(this,e,r,!0),r+2},s.prototype.writeInt16BE=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[r]=e>>>8,this[r+1]=255&e):j(this,e,r,!1),r+2},s.prototype.writeInt32LE=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[r]=255&e,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24):M(this,e,r,!0),r+4},s.prototype.writeInt32BE=function(e,r,t){return e=+e,r|=0,t||q(this,e,r,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),s.TYPED_ARRAY_SUPPORT?(this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e):M(this,e,r,!1),r+4},s.prototype.writeFloatLE=function(e,r,t){return Y(this,e,r,!0,t)},s.prototype.writeFloatBE=function(e,r,t){return Y(this,e,r,!1,t)},s.prototype.writeDoubleLE=function(e,r,t){return L(this,e,r,!0,t)},s.prototype.writeDoubleBE=function(e,r,t){return L(this,e,r,!1,t)},s.prototype.copy=function(e,r,t,n){if(t||(t=0),n||0===n||(n=this.length),r>=e.length&&(r=e.length),r||(r=0),n>0&&n<t&&(n=t),n===t)return 0;if(0===e.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(t<0||t>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-r<n-t&&(n=e.length-r+t);var o,i=n-t;if(this===e&&t<r&&r<n)for(o=i-1;o>=0;--o)e[o+r]=this[o+t];else if(i<1e3||!s.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+r]=this[o+t];else Uint8Array.prototype.set.call(e,this.subarray(t,t+i),r);return i},s.prototype.fill=function(e,r,t,n){if("string"==typeof e){if("string"==typeof r?(n=r,r=0,t=this.length):"string"==typeof t&&(n=t,t=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(r<0||this.length<r||this.length<t)throw new RangeError("Out of range index");if(t<=r)return this;r>>>=0,t=void 0===t?this.length:t>>>0,e||(e=0);var i;if("number"==typeof e)for(i=r;i<t;++i)this[i]=e;else{var a=s.isBuffer(e)?e:J(new s(e,n).toString()),u=a.length;for(i=0;i<t-r;++i)this[i+r]=a[i%u]}return this};var re=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":44,ieee754:49,isarray:46}],46:[function(e,r,t){var n={}.toString;r.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],47:[function(e,r,t){"use strict";function n(e){var r;if(!e||"string"!=typeof e)throw new TypeError('Argument "name" must be a non-empty string.');return r=new Function("setupError","return function "+e+" () { if (!(this instanceof "+e+")) return new ("+e+".bind.apply("+e+", Array.prototype.concat.apply([ null ], arguments))); setupError.apply(this, arguments); }")(o),r.prototype=Object.create(Error.prototype,{constructor:i(r),name:i(e)}),r}function o(e){s?Error.captureStackTrace(this,this.constructor):Object.defineProperty(this,"stack",i(Error(e).stack)),Object.defineProperty(this,"message",i(void 0!==e?""+e:""))}function i(e){return{value:e,writable:!0,configurable:!0}}var s="captureStackTrace"in Error;r.exports=n},{}],48:[function(e,r,t){function n(){if(!(this instanceof n))return new n}!function(e){function t(e){for(var r in f)e[r]=f[r];return e}function n(e,r){return a(this,e).push(r),this}function o(e,r){function t(){i.call(n,e,t),r.apply(this,arguments)}var n=this;return t.originalListener=r,a(n,e).push(t),n}function i(e,r){function t(e){return e!==r&&e.originalListener!==r}var n,o=this;if(arguments.length){if(r){if(n=a(o,e,!0)){if(n=n.filter(t),!n.length)return i.call(o,e);o[u][e]=n}}else if(n=o[u],n&&(delete n[e],!Object.keys(n).length))return i.call(o)}else delete o[u];return o}function s(e,r){function t(e){e.call(i)}function n(e){e.call(i,r)}function o(e){e.apply(i,f)}var i=this,s=a(i,e,!0);if(!s)return!1;var u=arguments.length;if(1===u)s.forEach(t);else if(2===u)s.forEach(n);else{var f=Array.prototype.slice.call(arguments,1);s.forEach(o)}return!!s.length}function a(e,r,t){if(!t||e[u]){var n=e[u]||(e[u]={});return n[r]||(n[r]=[])}}"undefined"!=typeof r&&(r.exports=e);var u="listeners",f={on:n,once:o,off:i,emit:s};t(e.prototype),e.mixin=t}(n)},{}],49:[function(e,r,t){t.read=function(e,r,t,n,o){var i,s,a=8*o-n-1,u=(1<<a)-1,f=u>>1,c=-7,l=t?o-1:0,p=t?-1:1,h=e[r+l];for(l+=p,i=h&(1<<-c)-1,h>>=-c,c+=a;c>0;i=256*i+e[r+l],l+=p,c-=8);for(s=i&(1<<-c)-1,i>>=-c,c+=n;c>0;s=256*s+e[r+l],l+=p,c-=8);if(0===i)i=1-f;else{if(i===u)return s?NaN:(h?-1:1)*(1/0);
s+=Math.pow(2,n),i-=f}return(h?-1:1)*s*Math.pow(2,i-n)},t.write=function(e,r,t,n,o,i){var s,a,u,f=8*i-o-1,c=(1<<f)-1,l=c>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:i-1,d=n?1:-1,y=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(a=isNaN(r)?1:0,s=c):(s=Math.floor(Math.log(r)/Math.LN2),r*(u=Math.pow(2,-s))<1&&(s--,u*=2),r+=s+l>=1?p/u:p*Math.pow(2,1-l),r*u>=2&&(s++,u/=2),s+l>=c?(a=0,s=c):s+l>=1?(a=(r*u-1)*Math.pow(2,o),s+=l):(a=r*Math.pow(2,l-1)*Math.pow(2,o),s=0));o>=8;e[t+h]=255&a,h+=d,a/=256,o-=8);for(s=s<<o|a,f+=o;f>0;e[t+h]=255&s,h+=d,s/=256,f-=8);e[t+h-d]|=128*y}},{}],50:[function(e,r,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function o(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}r.exports=function(e){return null!=e&&(n(e)||o(e)||!!e._isBuffer)}},{}]},{},[39]);
